<!DOCTYPE html>
<html>
<head>
	<title>Dev Test Kuau</title>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script type="text/javascript">

	function formatarData(d){

		var dia = d.substring(8, 10);
		var mes = d.substring(5, 7);
		var ano = d.substring(0, 4);

		return dia + '/' + mes + '/' + ano;
	}

	function getDetalhes(id){

		if($(id).find('div').hasClass('in'))
			return;

		//console.log('fazendo chamada para ' + 'https://api.github.com/users/' + $(id).data('user'));

		$.ajax({
			url: 'https://api.github.com/users/' + $(id).data('user'),
			type: 'GET',
			dataType: 'json',
			success: function(data){
				$(id).find('p').eq(0).text('E-mail: ' + (data.email === null ? '-' : data.email));
				$(id).find('p').eq(1).text(data.name + ' entrou em ' + (data.created_at === null ? '-' : formatarData(data.created_at)));
				$(id).find('p').eq(2).text('Possui ' + data.followers + ' seguidor(es) e está seguindo ' + data.following + ' pessoa(s)');
			},
			error: function(err){
				console.log(err);
			}
		});
	}
				
	$(document).ready(function(){

		$('#txtUser').keydown(function(){
		//$('#btnPesquisar').click(function(){

			$('#result').html('');

			if($('#txtUser').val().length < 4){
				return;
			}
			
			$.ajax({
				url: 'https://api.github.com/search/users?q=' + $('#txtUser').val().trim(),
				type: 'GET',
				dataType: 'json',
				success: function(msg){

					//console.log(msg);
					$('#count').text(msg.items.length);
					
					for(var i = 0; i < msg.items.length; i++){

						if(i == 100){
							break;
						}
						
						$('#result').append('<div onclick="getDetalhes(\'#card' + i + '\')" id="card' + i + '" class="alert alert-dark cartao" data-toggle="collapse" data-target="#demo' + i + '" data-user="' + msg.items[i]['login'] + '">'+
												'<img src="' + msg.items[i]['avatar_url'] + '" class="img-responsive img-rounded" style="margin-right:10px;" />'+
												'<a href="#">' + msg.items[i]['login']  + '</a>'+
												'<div id="demo' + i + '" class="collapse">'+
													'<p style="margin-top:5px;"></p>'+
													'<p></p>'+
													'<p></p>'+
												'</div>'+
											'</div>');
					}
					
					if(msg.total_count >= 100){
						$('#result').append('<div class="alert alert-dark">'+
												'<a href="#">Fim. Mostraremos até 100 usuários para não ficar tão extenso ;)</a>'+
											'</div>');
					}
				}
			});
		});
	});
	</script>
	<style type="text/css">
		html,body{
			height:100%;
		}
		
		.well{
			background-color:#1B1B1B;
			border-color:#1B1B1B;
			height:80%;
			position: relative;
			overflow-y: scroll;
			border-radius:0;
			margin:0;
		}

		.alert-dark{
			background-color:#525659;
			border-color:#525659;
			color:#fff;
		}

		.alert-dark:hover{
			background-color:#6f7173;
			border-color:#6f7173;
		}

		.alert-dark a{
			color:#fff;
			text-decoration:none;
			cursor:pointer;
		}

		.alert-dark img{
			height: 50px;
			display:inline-block;
		}

		p:first-child{
			margin-top:55px;
		}

		::-webkit-scrollbar {
		    width: 5px;
		}

		::-webkit-scrollbar-track {
		    background: #f1f1f1; 
		}

		::-webkit-scrollbar-thumb {
		    background: #888; 
		}

		::-webkit-scrollbar-thumb:hover {
		    background: #555; 
		}
		header{
			width:100%;
			height: 60px;
			background-color:#1B1B1B;
			padding: 8px;
			border-radius:5px 5px 0 0;
		}

		footer{
			width:100%;
			height: 40px;
			background-color:#1B1B1B;
			padding: 8px;
			border-radius: 0 0 5px 5px;
			color: white;
			font-size: 18px;
		}
		
	</style>
</head>
<body>
<br>
	<div class="col-md-4"></div>
	<div class="col-md-4" style="height:90%;">
		<header>
			<div class="input-group" style="">
				<input type="text" class="form-control input-lg" id="txtUser" placeholder="Pesquise aqui...">
				<div class="input-group-btn"> 
					<button class="btn btn-default btn-lg" id="btnPesquisar" type="submit"><i class="glyphicon glyphicon-search"></i></button>
				</div>
			</div>
		</header>
		<aside id="result" class="well">
		</aside>
		<footer>
			Total da pesquisa: <span id="count">0</span>
		</footer>
	<div class="col-md-4"></div>
</body>
</html>
